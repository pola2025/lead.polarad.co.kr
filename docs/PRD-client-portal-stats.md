# PRD: í´ë¼ì´ì–¸íŠ¸ í¬í„¸ í†µê³„ ê°œì„ 

## ê°œìš”

**í”„ë¡œì íŠ¸**: pola_lead í´ë¼ì´ì–¸íŠ¸ í¬í„¸ í†µê³„ ê¸°ëŠ¥ ê°œì„ 
**ì‘ì„±ì¼**: 2026-01-23
**ìƒíƒœ**: í™•ì •

---

## êµ¬í˜„ ë²”ìœ„ (í™•ì •)

### 1. ë¦¬ë“œ í†µê³„
- ì˜¤ëŠ˜/7ì¼/30ì¼ ì‹ ê·œ ë¦¬ë“œ ìˆ˜
- ì „í™˜ìœ¨ (ë°©ë¬¸ì ëŒ€ë¹„ ë¦¬ë“œ)

### 2. ê¸°ê¸°ë³„ ë°©ë¬¸ì
- ëª¨ë°”ì¼/ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿ ë¹„ìœ¨

### 3. í¼ë„ ë¶„ì„ (í•µì‹¬)
| ë‹¨ê³„ | ì„¤ëª… | ë°ì´í„° ì†ŒìŠ¤ |
|------|------|-------------|
| ë°©ë¬¸ | ëœë”©í˜ì´ì§€ ë°©ë¬¸ì | GA4 activeUsers |
| ë¡œê·¸ì¸ | ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì™„ë£Œ | Airtable (kakaoId ì¡´ì¬) |
| ì ‘ìˆ˜ì™„ë£Œ | í¼ ì œì¶œ ì™„ë£Œ | Airtable (status ê¸°ì¤€) |

**í¼ë„ ì‹œê°í™”:**
```
ë°©ë¬¸ (100ëª…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  â†“
ë¡œê·¸ì¸ (45ëª…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 45%
  â†“
ì ‘ìˆ˜ì™„ë£Œ (30ëª…) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 30%
```

---

## í˜„ì¬ ìƒíƒœ

### êµ¬í˜„ëœ í†µê³„ (GA4 ê¸°ë°˜)
- ì˜¤ëŠ˜/7ì¼/30ì¼ ë°©ë¬¸ì ìˆ˜
- ì¼ë³„ ë°©ë¬¸ì ì¶”ì´ (30ì¼)
- ìœ ì… ê²½ë¡œ TOP 5

---

## ê¸°ìˆ  êµ¬í˜„ ê³„íš

### 1. ë¦¬ë“œ í†µê³„ API

**íŒŒì¼**: `src/app/api/portal/[slug]/leads-stats/route.ts`

```typescript
interface LeadStats {
  today: number;
  week: number;
  month: number;
  daily: { date: string; leads: number }[];

  // í¼ë„ ë°ì´í„°
  funnel: {
    period: 'today' | 'week' | 'month';
    visitors: number;      // GA4 ë°©ë¬¸ì
    logins: number;        // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ (kakaoId ì¡´ì¬)
    submissions: number;   // ì ‘ìˆ˜ ì™„ë£Œ
  }[];
}
```

**Airtable ì¿¼ë¦¬ ë¡œì§:**
```typescript
// ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ë§Œ í•œ ê²½ìš°: kakaoId ìˆìŒ + ì ‘ìˆ˜ ë¯¸ì™„ë£Œ
const loginsOnly = leads.filter(l => l.kakaoId && !l.submitted);

// ì ‘ìˆ˜ ì™„ë£Œ: kakaoId ìˆìŒ + ì ‘ìˆ˜ ì™„ë£Œ
const submitted = leads.filter(l => l.kakaoId && l.submitted);
```

### 2. GA4 ê¸°ê¸°ë³„ í†µê³„ ì¶”ê°€

**íŒŒì¼**: `src/app/api/portal/[slug]/analytics/route.ts`

```typescript
// ì¶”ê°€í•  GA4 dimension
const [deviceReport] = await client.runReport({
  property: `properties/${propertyId}`,
  dateRanges: [{ startDate: formatDate(monthAgo), endDate: "today" }],
  dimensions: [{ name: "deviceCategory" }],
  metrics: [{ name: "activeUsers" }],
  dimensionFilter: { ... },
});
```

### 3. í”„ë¡ íŠ¸ì—”ë“œ UI

**íŒŒì¼**: `src/app/portal/[slug]/page.tsx`

**ë ˆì´ì•„ì›ƒ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ë°©ë¬¸ í†µê³„] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ì˜¤ëŠ˜   â”‚ â”‚  7ì¼    â”‚ â”‚  30ì¼   â”‚              â”‚
â”‚  â”‚   12    â”‚ â”‚   84    â”‚ â”‚  312    â”‚              â”‚
â”‚  â”‚ PV 15   â”‚ â”‚ PV 102  â”‚ â”‚ PV 425  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                     â”‚
â”‚  [ë¦¬ë“œ í†µê³„] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  ì˜¤ëŠ˜   â”‚ â”‚  7ì¼    â”‚ â”‚  30ì¼   â”‚              â”‚
â”‚  â”‚    2    â”‚ â”‚   15    â”‚ â”‚   48    â”‚              â”‚
â”‚  â”‚ ì „í™˜ 16%â”‚ â”‚ ì „í™˜ 18%â”‚ â”‚ ì „í™˜ 15%â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                     â”‚
â”‚  [ì „í™˜ í¼ë„ (30ì¼)] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ë°©ë¬¸      312ëª…  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%       â”‚
â”‚  ë¡œê·¸ì¸    140ëª…  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  45%       â”‚
â”‚  ì ‘ìˆ˜ì™„ë£Œ   48ëª…  â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  15%       â”‚
â”‚                                                     â”‚
â”‚  [ê¸°ê¸°ë³„ ë°©ë¬¸ì] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“± ëª¨ë°”ì¼    68%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘            â”‚
â”‚  ğŸ’» ë°ìŠ¤í¬í†±  30%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚
â”‚  ğŸ“± íƒœë¸”ë¦¿    2%  â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘             â”‚
â”‚                                                     â”‚
â”‚  [ì¼ë³„ ì¶”ì´ ì°¨íŠ¸] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  (ê¸°ì¡´ ìœ ì§€)                                       â”‚
â”‚                                                     â”‚
â”‚  [ìœ ì… ê²½ë¡œ TOP 5] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  (ê¸°ì¡´ ìœ ì§€)                                       â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê°œë°œ ìˆœì„œ (TDD)

### Step 1: ë¦¬ë“œ í†µê³„ API
1. âœ… í…ŒìŠ¤íŠ¸ ì‘ì„±: `src/__tests__/api/portal-leads-stats.test.ts`
2. âœ… API êµ¬í˜„: `src/app/api/portal/[slug]/leads-stats/route.ts`
3. âœ… í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### Step 2: GA4 ê¸°ê¸°ë³„ í†µê³„
1. âœ… analytics APIì— deviceCategory ì¶”ê°€
2. âœ… í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### Step 3: í”„ë¡ íŠ¸ì—”ë“œ UI
1. âœ… ë¦¬ë“œ í†µê³„ ì¹´ë“œ ì¶”ê°€
2. âœ… í¼ë„ ì°¨íŠ¸ ì¶”ê°€
3. âœ… ê¸°ê¸°ë³„ ì°¨íŠ¸ ì¶”ê°€

### Step 4: í…ŒìŠ¤íŠ¸ ë° ë°°í¬
1. âœ… ê°œë°œì„œë²„ í™•ì¸
2. âœ… ë°°í¬

---

## ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    GA4      â”‚     â”‚  Airtable   â”‚     â”‚   í¬í„¸ UI   â”‚
â”‚  Analytics  â”‚     â”‚   Leads     â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚        /api/portal/[slug]/           â”‚       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚  â”‚  analytics  â”‚  â”‚ leads-stats  â”‚   â”‚       â”‚
â”‚  â”‚    route    â”‚  â”‚    route     â”‚   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚         â”‚                â”‚           â”‚       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚       â”‚
â”‚                  â–¼                   â”‚       â”‚
â”‚            Combined Data             â”‚â—„â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## íŒŒì¼ ëª©ë¡

### ì‹ ê·œ ìƒì„±
- `src/app/api/portal/[slug]/leads-stats/route.ts`
- `src/__tests__/api/portal-leads-stats.test.ts`

### ìˆ˜ì •
- `src/app/api/portal/[slug]/analytics/route.ts` (ê¸°ê¸°ë³„ ì¶”ê°€)
- `src/app/portal/[slug]/page.tsx` (UI ì¶”ê°€)

---

## ì™„ë£Œ ê¸°ì¤€

- [ ] ë¦¬ë“œ í†µê³„ API ë™ì‘
- [ ] í¼ë„ ë°ì´í„° ì •í™•íˆ ê³„ì‚°
- [ ] ê¸°ê¸°ë³„ ë°©ë¬¸ì í‘œì‹œ
- [ ] ëª¨ë°”ì¼ UI ì •ìƒ í‘œì‹œ
- [ ] ê°œë°œì„œë²„ í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] Production ë°°í¬ ì™„ë£Œ
