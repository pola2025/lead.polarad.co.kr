# PRD: 동적 폼 필드 & 고객 여정 시스템

## 1. 개요

### 1.1 목적
클라이언트별 랜딩 페이지에서 다양한 형태의 입력 필드를 지원하고, 완성된 고객 여정을 시뮬레이션할 수 있게 하여 업종/서비스 특성에 맞는 맞춤형 리드 수집 경험을 제공한다.

### 1.2 핵심 가치
- **클라이언트:** 포털에서 디자인 상의 후 완성된 랜딩 페이지를 즉시 확인
- **고객(리드):** 브랜드에 맞는 일관된 경험 (랜딩 → 폼 작성 → 완료)
- **운영팀:** 고객사별 맞춤 설정을 코드 수정 없이 관리

### 1.3 배경
현재 시스템은 고정된 필드(이름, 연락처, 이메일 등)만 지원한다. 그러나 클라이언트마다 수집해야 하는 정보가 다르고, 특정 조건에 따라 추가 정보를 요청해야 하는 경우가 있다.

**예시 시나리오:**
- 경영컨설팅: "업종" 선택 시 → 제조업 선택 → 사업자등록번호 입력 필수
- 보험: "관심 상품" 선택 → 자동차보험 선택 → 차량번호 입력
- 교육: "수강 목적" 선택 → 취업 선택 → 희망 직종 입력

### 1.4 역할별 권한

> 상세 권한 매트릭스는 [ARCHITECTURE.md](./ARCHITECTURE.md) 참조

#### Admin (관리자)
- 클라이언트 생성/삭제, 계약 정보 관리
- 포털 비밀번호 생성 및 슬랙 전송
- 카카오/텔레그램 API 설정
- 전체 리드 조회 및 삭제 권한

#### Client (클라이언트)
포털에서 직접 설정 가능한 항목:
- ✅ 로고 업로드
- ✅ 브랜드 컬러 설정
- ✅ 랜딩 제목/설명
- ✅ CTA 버튼 텍스트
- ✅ 완료 메시지 설정
- ✅ 폼 필드 ON/OFF
- ✅ 폼 필드 순서 변경
- ✅ 필수 여부 설정
- ✅ 선다형 옵션 편집
- ✅ 조건부 필드 설정
- ✅ 자신의 리드 조회/상태 변경

포털에서 설정 불가 (Admin only):
- ❌ 클라이언트 삭제
- ❌ 계약 정보 변경
- ❌ 포털 비밀번호 변경
- ❌ 카카오/텔레그램 API 설정
- ❌ 리드 삭제

---

## 2. 필드 타입 정의

### 2.1 기본 필드 타입

| 타입 | 설명 | 예시 |
|------|------|------|
| `text` | 단문 텍스트 입력 | 이름, 회사명 |
| `textarea` | 장문 텍스트 입력 | 문의사항, 상세 설명 |
| `phone` | 전화번호 입력 (자동 포맷팅) | 010-1234-5678 |
| `email` | 이메일 입력 (유효성 검증) | example@email.com |
| `number` | 숫자 입력 | 나이, 예산 |
| `date` | 날짜 선택 | 생년월일, 희망 상담일 |
| `select` | 단일 선택 (드롭다운) | 업종 선택 |
| `radio` | 단일 선택 (라디오 버튼) | 성별, 예/아니오 |
| `checkbox` | 다중 선택 | 관심 서비스 (복수 선택) |
| `file` | 파일 업로드 | 사업자등록증, 증명서 |

### 2.2 필드 속성

```typescript
interface FormField {
  id: string;                    // 고유 식별자
  type: FieldType;               // 필드 타입
  label: string;                 // 표시 라벨
  placeholder?: string;          // 입력 힌트
  required: boolean;             // 필수 여부
  enabled: boolean;              // 활성화 여부
  order: number;                 // 표시 순서

  // 선택형 필드용
  options?: FieldOption[];       // 선택 옵션 목록

  // 조건부 표시용
  condition?: FieldCondition;    // 표시 조건

  // 유효성 검증용
  validation?: FieldValidation;  // 검증 규칙
}

interface FieldOption {
  value: string;                 // 저장 값
  label: string;                 // 표시 텍스트
  triggersFields?: string[];     // 이 옵션 선택 시 표시할 필드 ID 목록
}

interface FieldCondition {
  dependsOn: string;             // 의존하는 필드 ID
  showWhen: string | string[];   // 해당 값일 때 표시
}

interface FieldValidation {
  pattern?: string;              // 정규식 패턴
  minLength?: number;            // 최소 길이
  maxLength?: number;            // 최대 길이
  min?: number;                  // 최소값 (숫자)
  max?: number;                  // 최대값 (숫자)
  customMessage?: string;        // 커스텀 에러 메시지
}
```

---

## 3. 조건부 필드 시스템

### 3.1 동작 방식

```
[선택 필드] → [옵션 A 선택] → [조건부 필드 A1, A2 표시]
            → [옵션 B 선택] → [조건부 필드 B1 표시]
            → [옵션 C 선택] → [추가 필드 없음]
```

### 3.2 예시: 경영컨설팅 업종

```json
{
  "fields": [
    {
      "id": "name",
      "type": "text",
      "label": "이름",
      "required": true,
      "order": 0
    },
    {
      "id": "phone",
      "type": "phone",
      "label": "연락처",
      "required": true,
      "order": 1
    },
    {
      "id": "industry",
      "type": "select",
      "label": "업종",
      "required": true,
      "order": 2,
      "options": [
        { "value": "manufacturing", "label": "제조업", "triggersFields": ["businessNumber", "employeeCount"] },
        { "value": "service", "label": "서비스업", "triggersFields": ["serviceType"] },
        { "value": "retail", "label": "유통/판매", "triggersFields": ["storeCount"] },
        { "value": "other", "label": "기타" }
      ]
    },
    {
      "id": "businessNumber",
      "type": "text",
      "label": "사업자등록번호",
      "placeholder": "000-00-00000",
      "required": true,
      "order": 3,
      "condition": {
        "dependsOn": "industry",
        "showWhen": "manufacturing"
      },
      "validation": {
        "pattern": "^[0-9]{3}-[0-9]{2}-[0-9]{5}$",
        "customMessage": "올바른 사업자등록번호 형식이 아닙니다."
      }
    },
    {
      "id": "employeeCount",
      "type": "select",
      "label": "직원 수",
      "required": true,
      "order": 4,
      "condition": {
        "dependsOn": "industry",
        "showWhen": "manufacturing"
      },
      "options": [
        { "value": "1-10", "label": "1~10명" },
        { "value": "11-50", "label": "11~50명" },
        { "value": "51-100", "label": "51~100명" },
        { "value": "100+", "label": "100명 이상" }
      ]
    },
    {
      "id": "serviceType",
      "type": "checkbox",
      "label": "서비스 유형 (복수 선택 가능)",
      "required": true,
      "order": 3,
      "condition": {
        "dependsOn": "industry",
        "showWhen": "service"
      },
      "options": [
        { "value": "consulting", "label": "컨설팅" },
        { "value": "it", "label": "IT/소프트웨어" },
        { "value": "design", "label": "디자인" },
        { "value": "marketing", "label": "마케팅" }
      ]
    },
    {
      "id": "storeCount",
      "type": "number",
      "label": "매장 수",
      "required": true,
      "order": 3,
      "condition": {
        "dependsOn": "industry",
        "showWhen": "retail"
      }
    }
  ]
}
```

### 3.3 다단계 조건부 필드

중첩 조건도 지원:

```
업종 선택 → 제조업 → 직원 수 선택 → 100명 이상 → 연매출 입력
```

```json
{
  "id": "annualRevenue",
  "type": "select",
  "label": "연매출",
  "required": true,
  "order": 5,
  "condition": {
    "dependsOn": "employeeCount",
    "showWhen": "100+"
  },
  "options": [
    { "value": "under-10", "label": "10억 미만" },
    { "value": "10-50", "label": "10억~50억" },
    { "value": "50-100", "label": "50억~100억" },
    { "value": "100+", "label": "100억 이상" }
  ]
}
```

---

## 4. 고객 여정 시뮬레이션

### 4.1 개요

클라이언트가 포털에서 설정한 내용이 실제 고객에게 어떻게 보이는지 **실시간 미리보기**로 확인할 수 있는 기능.

```
┌─────────────────────────────────────────────────────────────────────┐
│                         고객 여정 시뮬레이션                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   [1. 랜딩]  ──▶  [2. 폼 작성]  ──▶  [3. 완료]                       │
│      ●              ○                 ○                            │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.2 3단계 고객 여정

#### Step 1: 랜딩 화면 (브랜딩)

```
┌─────────────────────────────────────┐
│                                     │
│            [로고 이미지]             │
│                                     │
│     ━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                     │
│         경영컨설팅 전문               │
│       무료 상담 신청하세요            │
│                                     │
│     ━━━━━━━━━━━━━━━━━━━━━━━━━━      │
│                                     │
│   전문 컨설턴트가 맞춤형 솔루션을     │
│   제안해 드립니다.                   │
│                                     │
│   ┌───────────────────────────┐    │
│   │      상담 신청하기 →       │    │
│   └───────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘

설정 항목:
- 로고 이미지
- 브랜드 컬러
- 랜딩 제목
- 랜딩 설명
- CTA 버튼 텍스트
```

#### Step 2: 폼 작성 화면

```
┌─────────────────────────────────────┐
│                                     │
│            [로고 이미지]             │
│                                     │
│  이름 *                             │
│  ┌───────────────────────────┐     │
│  │ 홍길동                     │     │
│  └───────────────────────────┘     │
│                                     │
│  연락처 *                           │
│  ┌───────────────────────────┐     │
│  │ 010-1234-5678             │     │
│  └───────────────────────────┘     │
│                                     │
│  업종 *                             │
│  ┌───────────────────────────┐     │
│  │ ▼ 선택하세요               │     │
│  └───────────────────────────┘     │
│                                     │
│  ┌───────────────────────────┐     │
│  │      상담 신청하기          │     │
│  └───────────────────────────┘     │
│                                     │
└─────────────────────────────────────┘

설정 항목:
- 폼 필드 선택 (체크박스로 ON/OFF)
- 필드 순서 (드래그 앤 드롭)
- 필수 여부 설정
- 선다형 옵션 편집
- 조건부 필드 연결
```

#### Step 3: 완료 화면

```
┌─────────────────────────────────────┐
│                                     │
│            [로고 이미지]             │
│                                     │
│               ✓                     │
│                                     │
│      신청이 완료되었습니다            │
│                                     │
│   빠른 시일 내에 연락드리겠습니다.    │
│   감사합니다!                        │
│                                     │
│   ┌───────────────────────────┐    │
│   │        홈으로 돌아가기      │    │
│   └───────────────────────────┘    │
│                                     │
└─────────────────────────────────────┘

설정 항목:
- 완료 제목
- 완료 메시지
- 추가 안내 (선택)
```

### 4.3 시뮬레이션 UI

```
┌─────────────────────────────────────────────────────────────────────────┐
│  폼 설정                                           미리보기 [모바일 ▼]  │
├───────────────────────────────────┬─────────────────────────────────────┤
│                                   │                                     │
│  ▼ 브랜딩 설정                     │    ┌─────────────────────┐         │
│    로고: [업로드]                  │    │                     │         │
│    브랜드 컬러: [#3b82f6]         │    │    [로고]           │         │
│    랜딩 제목: [________]          │    │                     │         │
│    랜딩 설명: [________]          │    │   경영컨설팅 전문    │         │
│                                   │    │                     │         │
│  ▼ 폼 필드 설정                    │    │   이름 *            │         │
│    ☑ 이름 (필수, 잠금)            │    │   ┌─────────────┐   │         │
│    ☑ 연락처 (필수, 잠금)          │    │   │             │   │         │
│    ☐ 이메일                       │    │   └─────────────┘   │         │
│    ☐ 회사/사업자명                 │    │                     │         │
│    ☑ 업종 ⚙️                      │    │   연락처 *          │         │
│    ☐ 사업자등록번호               │    │   ┌─────────────┐   │         │
│    ☐ 예산                         │    │   │             │   │         │
│    ☐ 문의사항                     │    │   └─────────────┘   │         │
│                                   │    │                     │         │
│  ▼ 응답 메시지 설정                │    │   [상담 신청하기]   │         │
│    완료 제목: [________]          │    │                     │         │
│    완료 메시지: [________]        │    └─────────────────────┘         │
│                                   │                                     │
│  [저장]                           │    [1.랜딩] [2.폼] [3.완료]         │
│                                   │                                     │
└───────────────────────────────────┴─────────────────────────────────────┘
```

### 4.4 디바이스 미리보기

```
┌─────────────────────────────────────┐
│  미리보기 디바이스                   │
│                                     │
│  [모바일]  [태블릿]  [데스크톱]       │
│     ●        ○         ○           │
│                                     │
│  ┌─────────┐  ┌─────────────┐      │
│  │ 📱      │  │ 💻          │      │
│  │ 375px   │  │ 1024px      │      │
│  └─────────┘  └─────────────┘      │
│                                     │
└─────────────────────────────────────┘
```

### 4.5 실시간 동기화

```
설정 변경 ──▶ 즉시 미리보기 반영 (debounce 300ms)

┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│  설정 패널    │ ──▶ │  상태 관리    │ ──▶ │  미리보기     │
│  (좌측)      │     │  (React)     │     │  (우측)      │
└──────────────┘     └──────────────┘     └──────────────┘
```

---

## 5. UI/UX 설계 (사용자 친화적)

### 4.1 포털 대시보드 - 필드 설정 화면

```
┌─────────────────────────────────────────────────────────────┐
│  폼 필드 설정                                    [+ 필드 추가] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ☰ 이름 (text)                              [필수] [활성] ⚙️  │
│  ├─ 라벨: 이름                                              │
│  └─ 플레이스홀더: 홍길동                                      │
│                                                             │
│  ☰ 연락처 (phone)                           [필수] [활성] ⚙️  │
│  ├─ 라벨: 연락처                                            │
│  └─ 플레이스홀더: 010-1234-5678                              │
│                                                             │
│  ☰ 업종 (select)                            [필수] [활성] ⚙️  │
│  ├─ 라벨: 업종                                              │
│  ├─ 옵션: 제조업, 서비스업, 유통/판매, 기타                    │
│  └─ 조건부 필드: 3개 연결됨                                   │
│                                                             │
│  └─ ☰ 사업자등록번호 (text)        [조건: 업종=제조업] [필수] ⚙️ │
│     ├─ 라벨: 사업자등록번호                                   │
│     └─ 유효성: 000-00-00000 형식                            │
│                                                             │
│  └─ ☰ 직원 수 (select)            [조건: 업종=제조업] [필수] ⚙️ │
│     └─ 옵션: 1~10명, 11~50명, 51~100명, 100명 이상           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 필드 추가/편집 모달

```
┌─────────────────────────────────────────────────┐
│  필드 추가                                   ✕  │
├─────────────────────────────────────────────────┤
│                                                 │
│  필드 타입                                      │
│  ┌─────────────────────────────────────────┐   │
│  │ ▼ 선택 (드롭다운)                        │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  라벨 *                                        │
│  ┌─────────────────────────────────────────┐   │
│  │ 업종                                     │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ☑ 필수 입력                                   │
│                                                 │
│  ─────────── 선택 옵션 ───────────             │
│                                                 │
│  옵션 1                                        │
│  ┌──────────────┐ ┌──────────────┐            │
│  │ manufacturing │ │ 제조업        │  [조건 설정] │
│  └──────────────┘ └──────────────┘            │
│                                                 │
│  옵션 2                                        │
│  ┌──────────────┐ ┌──────────────┐            │
│  │ service       │ │ 서비스업      │  [조건 설정] │
│  └──────────────┘ └──────────────┘            │
│                                                 │
│  [+ 옵션 추가]                                  │
│                                                 │
├─────────────────────────────────────────────────┤
│                          [취소]  [저장]         │
└─────────────────────────────────────────────────┘
```

### 4.3 조건 설정 모달

```
┌─────────────────────────────────────────────────┐
│  조건부 필드 설정 - "제조업" 선택 시             ✕  │
├─────────────────────────────────────────────────┤
│                                                 │
│  이 옵션 선택 시 표시할 필드:                     │
│                                                 │
│  ☑ 사업자등록번호 (text) - 필수                  │
│  ☑ 직원 수 (select) - 필수                      │
│  ☐ 연매출 (select) - 선택                       │
│                                                 │
│  [+ 새 조건부 필드 추가]                         │
│                                                 │
├─────────────────────────────────────────────────┤
│                          [취소]  [저장]         │
└─────────────────────────────────────────────────┘
```

### 4.4 랜딩 페이지 - 동적 폼 렌더링

```
┌─────────────────────────────────────────────────┐
│                                                 │
│              [로고]                             │
│                                                 │
│         경영컨설팅 무료 상담 신청                │
│                                                 │
│  이름 *                                        │
│  ┌─────────────────────────────────────────┐   │
│  │ 홍길동                                   │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  연락처 *                                      │
│  ┌─────────────────────────────────────────┐   │
│  │ 010-1234-5678                           │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  업종 *                                        │
│  ┌─────────────────────────────────────────┐   │
│  │ ▼ 제조업                                 │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─ 제조업 선택 시 표시 ─────────────────────┐   │
│  │                                          │   │
│  │  사업자등록번호 *                         │   │
│  │  ┌──────────────────────────────────┐   │   │
│  │  │ 123-45-67890                      │   │   │
│  │  └──────────────────────────────────┘   │   │
│  │                                          │   │
│  │  직원 수 *                               │   │
│  │  ┌──────────────────────────────────┐   │   │
│  │  │ ▼ 11~50명                        │   │   │
│  │  └──────────────────────────────────┘   │   │
│  │                                          │   │
│  └──────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │            상담 신청하기                  │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## 5. 데이터 저장 구조

### 5.1 Clients 테이블 (Airtable)

`formFields` 필드에 JSON으로 저장:

```json
{
  "fields": [...],
  "settings": {
    "submitButtonText": "상담 신청하기",
    "successTitle": "신청이 완료되었습니다",
    "successMessage": "빠른 시일 내에 연락드리겠습니다."
  }
}
```

### 5.2 Leads 테이블 (클라이언트별)

동적 필드 데이터는 `customFields` 컬럼에 JSON으로 저장:

```json
{
  "industry": "manufacturing",
  "businessNumber": "123-45-67890",
  "employeeCount": "11-50"
}
```

기존 고정 필드(name, phone, email 등)는 그대로 유지.

---

## 6. 구현 단계

### Phase 1: 기본 필드 타입 확장 (1주)
- [ ] 새로운 필드 타입 정의 (select, radio, checkbox, date, number)
- [ ] 랜딩 페이지에서 동적 필드 렌더링
- [ ] 포털에서 기본 필드 타입 선택 UI

### Phase 2: 선택형 필드 구현 (1주)
- [ ] 옵션 관리 UI (추가/수정/삭제/순서변경)
- [ ] select, radio, checkbox 렌더링
- [ ] 응답 데이터 저장 구조

### Phase 3: 조건부 필드 구현 (1주)
- [ ] 조건 설정 UI
- [ ] 조건부 표시/숨김 로직
- [ ] 중첩 조건 지원
- [ ] 조건부 필수 검증

### Phase 4: 고급 기능 (1주)
- [ ] 유효성 검증 규칙 설정
- [ ] 파일 업로드 필드
- [ ] 필드 그룹화 (섹션)
- [ ] 템플릿 저장/불러오기

---

## 7. 기술 고려사항

### 7.1 성능
- 조건부 필드 평가는 클라이언트 사이드에서 처리
- 복잡한 조건식은 최대 3단계 중첩까지 지원

### 7.2 유효성 검증
- 클라이언트 사이드: 실시간 피드백
- 서버 사이드: 최종 검증 (필수)

### 7.3 접근성
- 조건부 필드 표시 시 `aria-live` 사용
- 키보드 네비게이션 지원
- 스크린 리더 호환

### 7.4 모바일 대응
- 터치 친화적 선택 UI
- 조건부 필드 애니메이션 (slide down)

---

## 8. 성공 지표

| 지표 | 목표 |
|------|------|
| 폼 완료율 | 기존 대비 20% 향상 |
| 폼 작성 시간 | 평균 2분 이내 |
| 클라이언트 만족도 | 맞춤형 필드 설정 가능 |
| 리드 데이터 품질 | 조건부 필수 필드로 완전한 정보 수집 |

---

## 9. 리스크 및 대응

| 리스크 | 대응 방안 |
|--------|----------|
| 복잡한 조건 설정으로 사용성 저하 | 프리셋 템플릿 제공, 단계별 가이드 |
| 조건부 필드 버그 | 충분한 테스트 케이스, E2E 테스트 |
| 기존 데이터 마이그레이션 | 하위 호환성 유지, 점진적 마이그레이션 |

---

## 10. 용어 정의

| 용어 | 설명 |
|------|------|
| 조건부 필드 | 특정 조건이 충족될 때만 표시되는 필드 |
| 트리거 | 조건부 필드를 표시하게 만드는 선택 옵션 |
| 의존 필드 | 다른 필드의 값에 따라 표시 여부가 결정되는 필드 |
| 프리셋 | 미리 정의된 필드 구성 템플릿 |

---

**문서 버전:** 1.0
**작성일:** 2026-01-21
**작성자:** Claude
**검토자:** -
